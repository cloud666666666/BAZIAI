# BaziAI - 智能八字分析系统

一个基于中国传统八字命理学的智能分析系统，结合易经卦象和AI技术，为用户提供全面的八字分析和人生指导。

## 🌟 功能特色

### 核心功能
- **八字计算**: 基于二十四节气的精确八字计算
- **易经卦象**: 自动生成主卦和变卦，提供卦象分析
- **五行分析**: 天干地支五行属性分析
- **AI智能分析**: 集成大语言模型，提供个性化的人生指导
- **流式输出**: 实时显示AI分析结果，提升用户体验

### 技术特点
- **精确计算**: 使用真实的二十四节气数据，确保八字计算的准确性
- **现代化界面**: 响应式Web界面，支持移动端访问
- **实时分析**: 流式传输AI分析结果，无需等待
- **数据缓存**: 节气数据本地缓存，减少API调用

## 🚀 快速开始

### 环境要求
- Python 3.7+
- Flask 2.3.3+
- OpenAI API (可选，用于AI分析)

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/cloud666666666/bazi_Rag.git
cd bazi_Rag
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置环境变量** (可选)
```bash
# 设置OpenAI API密钥 (用于AI分析功能)
export OPENAI_API_KEY="your-api-key-here"

# 设置二十四节气API密钥 (用于获取节气数据)
export ALAPI_TOKEN="your-alapi-token-here"
```

4. **运行应用**
```bash
python app.py
```

5. **访问系统**
打开浏览器访问: `http://localhost:5000`

## 📁 项目结构

```
bazi_Rag/
├── app.py                 # Flask主应用
├── hexagrams.py           # 易经六十四卦数据
├── time_bazi.py          # 八字计算核心模块
├── solar_data.json       # 二十四节气数据缓存
├── requirements.txt      # Python依赖包
├── templates/
│   └── bazi_input.html   # 用户界面模板
├── static/
│   └── styles.css        # 样式文件
└── README.md            # 项目说明文档
```

## 🔧 核心模块说明

### 1. 八字计算模块 (`time_bazi.py`)
- **年柱计算**: 基于立春确定农历年份
- **月柱计算**: 根据二十四节气确定月份
- **日柱计算**: 使用公历日期计算天干地支
- **时柱计算**: 根据时辰确定时柱
- **节气数据**: 自动获取和缓存二十四节气数据

### 2. 易经卦象模块 (`hexagrams.py`)
- 包含完整的六十四卦数据
- 每卦包含名称、含义、描述和六爻辞
- 支持主卦和变卦的生成

### 3. Web应用模块 (`app.py`)
- Flask Web框架
- 流式AI分析接口
- 八字到卦象的转换算法
- 完整的分析结果展示

## 🎯 使用说明

### 输入信息
1. **出生年份**: 1900-2100年
2. **出生月份**: 1-12月
3. **出生日期**: 1-31日
4. **出生时辰**: 选择对应的时辰

### 分析结果
系统将提供以下分析内容：

1. **八字信息**
   - 完整的八字显示
   - 生肖信息
   - 农历相关信息

2. **卦象分析**
   - 主卦和变卦
   - 卦辞和含义
   - 基础卦象分析

3. **五行信息**
   - 天干五行属性
   - 地支五行属性

4. **AI智能分析**
   - 个性化的人生指导
   - 性格特点分析
   - 运势建议

## 🔮 八字计算原理

### 年柱确定
- 以立春为界确定农历年份
- 使用1984年甲子年为基准进行计算

### 月柱确定
- 以立春为正月开始
- 根据二十四节气确定月份
- 使用年干推月干的规则

### 日柱确定
- 使用公历日期计算
- 以1900年1月31日甲子日为基准

### 时柱确定
- 根据时辰确定地支
- 使用日干推时干的规则

## 🌐 API接口

### 主要接口

- `GET /`: 主页面
- `POST /bazi_analysis`: 八字分析 (非流式)
- `POST /bazi_analysis_stream`: 八字分析 (流式)

### 请求参数
```json
{
    "year": 2002,
    "month": 1,
    "day": 19,
    "hour": 5
}
```

### 响应格式
```json
{
    "八字": "壬午 癸丑 壬寅 癸卯",
    "生肖": "马",
    "主卦": {
        "名称": "乾卦",
        "卦辞": "天。代表刚健、积极和创造力。"
    },
    "变卦": {
        "名称": "坤卦", 
        "卦辞": "地。代表柔顺、包容和接受。"
    },
    "五行信息": {
        "天干五行": "壬水 癸水 壬水 癸水",
        "地支五行": "午火 丑土 寅木 卯木"
    }
}
```

## 🛠️ 技术栈

- **后端**: Python 3.7+, Flask 2.3.3
- **前端**: HTML5, CSS3, JavaScript
- **AI集成**: OpenAI API
- **数据源**: 二十四节气API
- **缓存**: JSON文件缓存

## 📝 开发说明

### 添加新的卦象分析
在 `app.py` 中的 `analysis_dict` 字典中添加新的卦象组合分析：

```python
analysis_dict['主卦ID']['变卦ID'] = "分析内容"
```

### 自定义AI分析
修改 `get_bazi_analysis` 函数中的提示词模板，可以自定义AI分析的内容和风格。

### 扩展功能
- 可以添加更多命理分析功能
- 支持更多AI模型
- 添加用户数据存储
- 实现分析历史记录

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- 感谢中国传统文化的智慧
- 感谢开源社区的支持
- 感谢所有贡献者的努力

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue: [GitHub Issues](https://github.com/cloud666666666/bazi_Rag/issues)
- 邮箱: [您的邮箱]

---

**注意**: 本系统仅供娱乐和学习参考，不应作为人生重大决策的唯一依据。请理性对待分析结果。